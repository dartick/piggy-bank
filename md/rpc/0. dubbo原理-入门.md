# Dubbo 原理-入门



## RPC介绍

Dubbo首先是RPC框架, 那么RPC是什么, 为什么要用RPC, RPC的作用, 从单体架构到微服务架构的演变过程, rmi

## 应用

1. 哪几种配置方式? 

   1）Spring 配置方式, 衍生出 Spring 的整合, 从而了解框架整合 spring 原理

   2）Java API 配置方式

2. 核心配置说明及其之间的关系

   dubbo:service/ 服务提供者暴露服务配置

   dubbo:reference/ 服务消费者引用服务配置

   dubbo:protocol/ 服务提供者协议配置

   dubbo:registry/ 注册中心配置

   dubbo:application/ 应用信息配置

   dubbo:provider/ 服务提供者缺省值配置

   dubbo:consumer/ 服务消费者缺省值配置

   dubbo:method/ 方法级配置

3. 在 Provider 上可以配置的 Consumer 端的属性有哪些

   1）timeout：方法调用超时

   2）retries：失败重试次数，默认重试 2 次

   3）loadbalance：负载均衡算法，默认随机

   4）actives 消费者端，最大并发调用限制

## 最佳实践

1. 服务上线怎么兼容旧版本
2. 对结果进行缓存
3. 参数校验
4. 异常处理
5. 异步调用
6. RpcContext
7. 解决服务调用链过长的问题
8. 接口如何实现幂等性

## 服务调用过程

Dubbo 服务调用过程比较复杂，包含众多步骤，比如发送请求、编解码、服务降级、过滤器链处理、序列化、线程派发以及响应请求等步骤。

![](https://static.geekbang.org/infoq/5c3d6918300c3.png?imageView2/0/w/800)

1. 有哪几种节点角色, 哪几种节点参与服务调用过程

## 服务引入(服务订阅)

1. 服务发现流程

## 服务导出(服务暴露, 服务发布)

1. 服务注册流程

## 注册中心

服务注册/反注册：服务实例将自身服务信息注册到注册中心。这部分服务信息包括服务所在主机IP和提供服务的Port，以及暴露服务自身状态以及访问协议等信息。

服务发现：服务实例请求注册中心获取所依赖服务信息。服务实例通过注册中心，获取到注册到其中的服务实例的信息，通过这些信息去请求它们提供的服务。

1. 默认使用什么注册中心

   推荐使用 Zookeeper 作为注册中心，还有 Redis、Multicast、Simple 注册中心，但不推荐。

2. 注册中心存储的内容 

3. 为什么不用zookeeper

4. 同步机制和缓存机制

## 代理机制

1. 默认的代理方式

## 通讯机制

1. 支持的协议

   - dubbo://（推荐）
   - rmi://
   - hessian://
   - http://
   - webservice://
   - thrift://
   - memcached://
   - redis://
   - rest://

2. 支持服务多协议吗？

   在不同服务上支持不同协议或者同一服务上同时支持多种协议。

3. 通讯框架

   Dubbo 默认使用 Netty 框架，也是推荐的选择，另外内容还集成有Mina、Grizzly。

4. 推荐的是dubbo协议, 但是为什么序列化框架不推荐dubbo, 他们之间的关系什么

## 序列化框架

推荐使用Hessian序列化，还有Duddo、FastJson、Java自带序列化。

1. 推荐使用什么序列化框架
2. 序列化框架的比较

## 服务容器

1. 服务容器是什么
2. 有哪几种服务容器
   - Spring Container
   - Jetty Container
   - Log4j Container
3. 需要 Web 容器吗?

## SPI机制

SPI 全称为 Service Provider Interface，是一种服务发现机制。SPI 的本质是将接口实现类的全限定名配置在文件中，并由服务加载器读取配置文件，加载实现类。这样可以在运行时，动态为接口替换实现类。正因此特性，我们可以很容易的通过 SPI 机制为我们的程序提供拓展功能。

1. SPI 的设计思想是什么?

## 服务路由

## 安全机制

## 集群

集群模块是服务提供者和服务消费者的中间层，为服务消费者屏蔽了服务提供者的情况，这样服务消费者就可以专心处理远程调用相关事宜。

1. 多少种容错机制, Dubbo启动时如果依赖的服务不可用会怎样？

   - Failover Cluster - 失败自动切换
   - Failfast Cluster - 快速失败
   - Failsafe Cluster - 失败安全
   - Failback Cluster - 失败自动恢复
   - Forking Cluster - 并行调用多个服务提供者

   Dubbo 缺省会在启动时检查依赖的服务是否可用，不可用时会抛出异常，阻止 Spring 初始化完成，默认 check="true"，可以通过 check="false" 关闭检查。

2. 服务读写推荐的容错策略是怎样的

## 负载均衡

它的职责是将网络请求，或者其他形式的负载“均摊”到不同的机器上。避免集群中部分服务器压力过大，而另一些服务器比较空闲的情况。通过负载均衡，可以让每台服务器获取到适合自己处理能力的负载。在为高负载服务器分流的同时，还可以避免资源浪费，一举两得。

1. 哪几种负载均衡策略，默认是哪种？

2. 注册了多个同一样的服务，如果测试指定的某一个服务呢？

   可以配置环境点对点直连，绕过注册中心，将以服务接口为单位，忽略注册中心的提供者列表。

## 服务治理

1. 服务的管理与监控, 还有服务的降级和限流。

## 线上问题

1. Spring 2.x 初始化死锁

## RPC框架

1. spring cloud
2. Dubbox
3. Thrift
4. Finagle 

## 疑问点

1. dubbo协议的单链接长链接的实现方式
# 学习dubbo应知应会

## 概念

### RPC

#### RPC是什么, 为什么要用RPC

RPC ( Remote Procedure Call ) 是指远程过程调用，也就是说两台服务器A，B，一个应用部署在A服务器上，想要调用B服务器上应用提供的函数/方法，由于不在一个内存空间，不能直接调用，需要通过网络来表达调用的语义和传达调用的数据。

#### 实现RPC需要解决什么问题

RPC的调用过程如下:

![img](https://pic4.zhimg.com/80/45366c44f775abfd0ac3b43bccc1abc3_hd.jpg)

1. Client像调用本地服务似的调用远程服务； 
2.  Client stub接收到调用后，将方法、参数序列化 
3. 客户端通过sockets将消息发送到服务端 
4. Server stub 收到消息后进行解码（将消息对象反序列化） 
5. Server stub 根据解码结果调用本地的服务 
6. 本地服务执行(对于服务端来说是本地执行)并将结果返回给Server stub 
7. Server stub将返回结果打包成消息（将结果消息对象序列化） 
8. 服务端通过sockets将消息发送到客户端 
9. Client stub接收到结果消息，并进行解码（将结果消息发序列化） 
10. 客户端得到最终结果。

那么RPC需要解决:

1. 通讯问题. 主要是通过在客户端和服务器之间建立TCP连接，远程过程调用的所有交换的数据都在这个连接里传输。
2. 寻址. A服务器上的应用怎么告诉底层的RPC框架，如何连接到B服务器（如主机或IP地址）以及特定的端口号，方法的名称是什么，这样才能完成调用，比如基于WEB服务协议的RPC，就要提供一个endpoint URI，或者是从UDDI服务上查找。如果是RMI调用的话，还需要一个RMI Registry来注册服务的地址。
3. 序列化. 当A服务器上的应用发起远程过程调用时，方法的参数需要通过底层的网络协议如TCP传递到B服务器，由于网络协议是基于 二进制的，内存中的参数的值要序列化成二进制的形式，也就是序列化（Serialize）或编组(marshal)，通过寻址和传输将序列化的二进制发送给B服务器。

> endpoint URI: 远程服务的具体调用url
>
> UDDI服务: 是一个公共的注册表，旨在以一种结构化的方式来保存有关各公司及其服务的信息。通过 UDDI，人们可以发布和发现有关某个公司及其 Web 服务的信息。

#### Stub的理解

单纯对Stub的翻译是存根, 树墩, 还是不理解, 而百度百科对存根的解释是: 票据、证件等开出后所留的底子(啥玩意儿). 然后知乎搜了一下, 发现了**R大**(天了乎)的[回答](https://www.zhihu.com/question/24844900): **它们并不是最终的调用目标，而是做一些简单的处理之后“跳”到真正的目标去。** R大的回答肯定是无条件信服的, 那么这样的话, 重新再理解, stub对应的翻译是树墩, client stub就相当于跳板, 并没有做最终的调用, 而是发送到远程服务去做真正的调用, 这样理解就通了.

#### RPC处于OSI的哪一层

在OSI模型中, RPC属于会话层, 会话层的功能是给应用程序创建, 关闭和管理会话的.也就是应用程序在发起RPC调用时, 不需要关心会话相关的事情. 但RPC可通过Http来实现, 而Http是处于应用层协议, 那有比应用层还要高的层次吗? 实际上RPC并不属于网络协议的范畴, 在RPC的实现中, 需要用到通讯协议, 通讯协议可以使用http, 也可以自定义. 那OSI为什么要把RPC定义在会话层呢?  如果这样理解的话就通了, OSI定义的是RPC需要的通讯协议属于会话层, 这样一想, http囊括了会话层, 所以可以通过http来实现RPC.

> 会话层与传输层的区别?
>
> 传输层: 两个人要通信了，由于传输途径的限制，一封信会被切割为一个一个段落（segment）。那么其中一个段落传丢了怎么办？要不要重传？每个段落，要顺讯到达吗？这些就是 TCP/UDP 的区别。传输层用来解决这些问题。
>
> 会话层: 既然两个人要通信，如何开始？过了一段时间，不想继续通信了，如何结束？这些都是会话层要处理的。

![img](https://img-blog.csdn.net/20140924202143732?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvYmFpZ29vY24=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)

### RMI

RMI的全称为 Java远程方法调用(Java Remote Method Invocation), 所以也是远程调用, 但是专门属于java语言里的, 能够让在某个java虚拟机上的对象像调用本地对象一样调用另一个java 虚拟机中的对象上的方法。所以其与RPC的关系是, RMI属于RPC在面向对象程序设计中更加具体的定义, 即 RMI = RPC + 面向对象. 那么更加具体的地方在于:

	1.	仅限于Java语言
 	2.	以远程接口的形式进行调用

![img](https://img-blog.csdn.net/20130813104359359?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvYTE5ODgxMDI5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)

RMI调用过程:

1. 客户对象调用客户端辅助对象上的方法

2. 客户端辅助对象打包调用信息（变量，方法名），通过网络发送给服务端辅助对象

3. 服务端辅助对象将客户端辅助对象发送来的信息解包，找出真正被调用的方法以及该方法所在对象

4. 调用真正服务对象上的真正方法，并将结果返回给服务端辅助对象

5. 服务端辅助对象将结果打包，发送给客户端辅助对象

6. 客户端辅助对象将返回值解包，返回给客户对象

7. 客户对象获得返回值

### Dubbo

随着互联网的发展，网站应用的规模不断扩大，常规的垂直应用架构已无法应对，分布式服务架构以及流动计算架构势在必行，亟需一个治理系统确保架构有条不紊的演进。



## 引用

1. [谁能用通俗的语言解释一下什么是 RPC 框架？](https://www.zhihu.com/question/25536695)

​	


# dubbo-通讯协议

## 领域模型

### Codec2

编码解码, 协议的报文是固定格式的, 通过 Codec2 来完成通讯过程中的报文的编码和解码

## 面试题

### dubbo协议为什么采用异步单一长连接?

因为服务的现状大都是服务提供者少，通常只有几台机器，而服务的消费者多，可能整个网站都在访问该服务，比如 Morgan 的提供者只有 6 台提供者，却有上百台消费者，每天有 1.5 亿次调用，如果采用常规的 hessian 服务，服务提供者很容易就被压跨，通过单一连接，保证单一消费者不会压死提供者，长连接，**减少连接握手验证**等，并使用异步 IO，**复用线程池，防止 C10K** 问题。

### dubbo协议为什么不能传大包?

**因 dubbo 协议采用单一长连接(使用小包支持高并发, 大包占满宽带, 降低并发)**，如果每次请求的数据包大小为 500KByte，假设网络为千兆网卡，每条连接最大 7MByte(不同的环境可能不一样，供参考)，单个服务提供者的 TPS(每秒处理事务数)最大为：128MByte / 500KByte = 262。单个消费者调用单个服务提供者的 TPS(每秒处理事务数)最大为：7MByte / 500KByte = 14。如果能接受，可以考虑使用，否则网络将成为瓶颈。

### dubbo协议为什么要消费者比提供者个数多?

因 dubbo 协议采用单一长连接，假设网络为千兆网卡 ，根据测试经验数据每条连接最多只能压满 7MByte(不同的环境可能不一样，供参考)，理论上 1 个服务提供者需要 20 个服务消费者才能压满网卡。

> 个人觉得这个问题没什么意义, 为了充分利用网络带宽, 而去增加消费者的数量, 消费者的增加必然会导致其他资源的消耗, 这就有点本末倒置了.
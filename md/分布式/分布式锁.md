# 分布式锁
## 应用场景
分布式应用下，保证同一时间，只有一个应用能够进入同步块
## 需求
1.  可重入（避免死锁）
2.  阻塞（业务需求）
3.  公平（业务需求）
4.  高可用
5.  高性能
## 解决方案
### 数据库

1.  利用唯一索引
    * 获取锁：插入
    * 释放锁：删除
2.  排他锁
    * 获取锁：select for update
    * 释放锁：提交事务

### redis setnx + expire + delete
1. setnx来获取锁
2. expire防止死锁 (expire前挂掉依然会出现问题)
3. delete释放锁（事务判断凭证防止释放别人的锁）

### redis setnx + get + getset
1. setnx来获取锁, 值为过期时间
2. get判断锁是否过期
3. 过期情况下通过getset获取锁
4. delete释放锁

### redlock
通过redis集群来实现，解决单点问题

由于分布式时钟问题，无法保证锁的过期到达一致，从而产生问题

### zookeeper
通过创建临时节点（进程挂掉会自动删除）来获取锁
通过watch机制来等待锁
有效解决单点问题，重入问题，阻塞问题
缺点：
1. 性能没有redis锁好，主要原因在节点数据同步
